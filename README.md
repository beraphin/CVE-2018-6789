# CVE-2018-6789

#### 环境搭建
安装依赖
````shell
apt-get install gcc net-tools vim gdb python wget git make procps libpcre3-dev libdb-dev libxt-dev libxaw7-dev
````
下载旧版本的exim
```shell
wget ftp://mirror.easyname.at/exim-ftp/exim/exim4/old/exim-4.89.tar.gz
tar -xvzf ./exim-4.89.tar.gz
cd ./exim-4.89.tar.gz
cp src/EDITME Local/Makefile
cp exim_monitor/EDITME Local/eximon.conf
````
然后修改Local/Makefile
为了方便其中各个文件夹都指向当前目录下
````shell
BIN_DIRECTORY=/home/zzx/EVA/cve-2018-6789/exim-4.89/bin
CONFIGURE_FILE=/home/zzx/EVA/cve-2018-6789/exim-4.89/configure
SPOOL_DIRECTORY=/home/zzx/EVA/cve-2018-6789/exim-4.89/exim
EXIM_USER=zzx
AUTH_PLAINTEXT=yes
````
修改OS/Makefile-Linux
````shell
CFLAGS ?= -O -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE
````
改为
````shell
CFLAGS ?= -g -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE
````
这样便于调试
然后编译安装
````shell
make install
````
修改./configure
````shell
PLAIN:
driver = plaintext
public_name = PLAIN
server_condition = “$if{{ and {{eq{$auth2}{username}}{eq{$auth3}{mysecret}}}}”
server_set_id = $auth2
````
#### 运行
````shell
./bin/exim -bdf -d+all
````


#### Reference
https://medium.com/@straightblast426/my-poc-walk-through-for-cve-2018-6789-2e402e4ff588
